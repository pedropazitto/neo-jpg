<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0d0d1a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon-192.png">
<link rel="apple-touch-icon" href="icon-512.png">
<title>Neo.jpg</title>
<style>
:root{--bg:#0d0d1a;--card:#161630;--accent:#7c5cfc;--accent2:#00d2ff;--danger:#ff6b6b;--success:#00b894;--txt:#e8e8f0;--txt2:#6b6b88;--radius:16px;--safe-b:env(safe-area-inset-bottom,0px)}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{overscroll-behavior:none}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Inter',sans-serif;background:var(--bg);color:var(--txt);min-height:100vh;min-height:100dvh;display:flex;flex-direction:column;padding:0;user-select:none;-webkit-user-select:none}
.topbar{position:sticky;top:0;z-index:10;background:rgba(13,13,26,.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);padding:14px 20px;padding-top:max(14px,env(safe-area-inset-top));display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,.05)}
.topbar h1{font-size:1.25em;background:linear-gradient(135deg,#ff6b6b,#ffc83d,#7c5cfc,#00d2ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:-.5px}
.topbar .gear{width:36px;height:36px;border-radius:10px;background:var(--card);border:1px solid rgba(255,255,255,.06);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:1.1em;transition:background .15s}
.topbar .gear:active{background:var(--accent);transform:scale(.93)}
.settings-panel{display:none;background:var(--card);border-bottom:1px solid rgba(255,255,255,.05);padding:16px 20px;gap:12px;flex-direction:column}
.settings-panel.open{display:flex}
.setting-row{display:flex;align-items:center;justify-content:space-between}
.setting-row label{font-size:.85em;color:var(--txt2)}
.setting-row input,.setting-row select{background:var(--bg);border:1px solid rgba(255,255,255,.08);border-radius:10px;color:#fff;padding:8px 12px;font-size:.9em;text-align:center;width:90px;outline:none;transition:border .15s}
.setting-row select{width:100px;text-align:left}
.setting-row input:focus,.setting-row select:focus{border-color:var(--accent)}
.content{flex:1;padding:20px;display:flex;flex-direction:column;gap:16px;overflow-y:auto;-webkit-overflow-scrolling:touch;padding-bottom:calc(80px + var(--safe-b))}
.drop-zone{border:2px dashed rgba(124,92,252,.3);border-radius:var(--radius);padding:48px 20px;text-align:center;cursor:pointer;transition:all .2s;flex-shrink:0;position:relative;overflow:hidden}
.drop-zone::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at center,rgba(124,92,252,.06) 0%,transparent 70%);pointer-events:none}
.drop-zone:active,.drop-zone.drag-over{border-color:var(--accent);background:rgba(124,92,252,.08);transform:scale(.98)}
.drop-zone input{display:none}
.drop-zone .icon{font-size:3em;margin-bottom:10px;display:block}
.drop-zone .label{font-size:1em;font-weight:600;color:var(--txt)}
.drop-zone .sub{font-size:.78em;color:var(--txt2);margin-top:6px}
.results{display:flex;flex-direction:column;gap:14px}
.card{background:var(--card);border-radius:var(--radius);overflow:hidden;animation:slideUp .35s ease}
@keyframes slideUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:none}}
.card .preview{width:100%;aspect-ratio:16/10;object-fit:cover;background:#111;display:block}
.card .body{padding:14px 16px}
.card .meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.card .fname{font-size:.85em;font-weight:600;color:var(--txt);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60%}
.card .size{font-size:.8em;font-weight:700;padding:4px 10px;border-radius:20px}
.card .size.ok{background:rgba(0,184,148,.12);color:var(--success)}
.card .size.over{background:rgba(255,107,107,.12);color:var(--danger)}
.card .dims{font-size:.75em;color:var(--txt2);margin-bottom:12px}
.card .actions{display:flex;gap:8px}
.card .actions a,.card .actions button{flex:1;text-align:center;padding:12px;border-radius:12px;font-size:.85em;font-weight:600;border:none;cursor:pointer;text-decoration:none;transition:all .15s;display:flex;align-items:center;justify-content:center;gap:6px}
.card .actions a{background:var(--accent);color:#fff}
.card .actions a:active{background:#6a4de0;transform:scale(.96)}
.card .actions button{background:rgba(0,184,148,.12);color:var(--success)}
.card .actions button:active{background:rgba(0,184,148,.2);transform:scale(.96)}
.fab-bar{display:none;position:fixed;bottom:0;left:0;right:0;padding:12px 20px;padding-bottom:max(12px,var(--safe-b));background:rgba(13,13,26,.9);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-top:1px solid rgba(255,255,255,.05);z-index:10;gap:10px}
.fab-bar.show{display:flex}
.fab-bar button{flex:1;padding:14px;border-radius:14px;font-size:.9em;font-weight:700;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;transition:all .15s}
.fab-bar .dl-all{background:var(--accent);color:#fff}
.fab-bar .dl-all:active{transform:scale(.96)}
.fab-bar .clear{background:rgba(255,107,107,.1);color:var(--danger)}
.fab-bar .clear:active{transform:scale(.96)}
.footer{text-align:center;padding:20px 16px 10px;font-size:.7em;color:var(--txt2);opacity:.6;font-style:italic;letter-spacing:.3px}
.empty-hint{text-align:center;color:var(--txt2);font-size:.82em;padding:30px 0}
.processing{position:fixed;inset:0;background:rgba(13,13,26,.8);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;z-index:100;flex-direction:column;gap:14px}
.processing.show{display:flex}
.spinner{width:40px;height:40px;border:3px solid rgba(124,92,252,.2);border-top-color:var(--accent);border-radius:50%;animation:spin .7s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.processing p{color:var(--txt2);font-size:.9em}
</style>
</head>
<body>
<div class="topbar">
  <h1>Neo.jpg</h1>
  <div class="gear" id="gearBtn" role="button" aria-label="Settings">‚öôÔ∏è</div>
</div>
<div class="settings-panel" id="settingsPanel">
  <div class="setting-row"><label>Max dimension</label><input type="number" id="maxDim" value="600" min="50" max="4000" step="50"> px</div>
  <div class="setting-row"><label>Max file size</label><input type="number" id="maxKB" value="80" min="5" max="5000" step="5"> KB</div>
  <div class="setting-row"><label>Output format</label>
    <select id="fmt">
      <option value="image/jpeg" selected>.jpg</option>
      <option value="image/webp">.webp</option>
      <option value="image/png">.png</option>
    </select>
  </div>
</div>
<div class="content">
  <div class="drop-zone" id="dropZone">
    <span class="icon">üì∏</span>
    <div class="label">Tap to select images</div>
    <div class="sub">or drag & drop</div>
    <input type="file" id="fileInput" multiple accept="image/*">
  </div>
  <div class="results" id="results"></div>
  <div class="empty-hint" id="emptyHint" style="display:none">Your compressed images will appear here</div>
  <div class="footer">Created for Aline, my love! üíú</div>
</div>
<div class="fab-bar" id="fabBar">
  <button class="clear" onclick="clearAll()">‚úï Clear</button>
  <button class="dl-all" onclick="downloadAll()">‚¨á Download All</button>
</div>
<div class="processing" id="processing">
  <div class="spinner"></div>
  <p id="procText">Processing...</p>
</div>
<script>
const $=id=>document.getElementById(id);
const dz=$('dropZone'),fi=$('fileInput'),res=$('results'),fab=$('fabBar'),proc=$('processing'),hint=$('emptyHint');
let blobs=[];
$('gearBtn').addEventListener('click',()=>{$('settingsPanel').classList.toggle('open')});
dz.addEventListener('click',()=>fi.click());
dz.addEventListener('dragover',e=>{e.preventDefault();dz.classList.add('drag-over')});
dz.addEventListener('dragleave',()=>dz.classList.remove('drag-over'));
dz.addEventListener('drop',e=>{e.preventDefault();dz.classList.remove('drag-over');handleFiles(e.dataTransfer.files)});
fi.addEventListener('change',()=>{handleFiles(fi.files);fi.value=''});
function handleFiles(files){
  if(!files.length)return;
  res.innerHTML='';blobs=[];fab.classList.remove('show');hint.style.display='none';
  proc.classList.add('show');
  const n=files.length;let done=0;
  $('procText').textContent='Processing '+n+' image'+(n>1?'s':'')+'...';
  Array.from(files).forEach((f,i)=>processImage(f,i,()=>{
    done++;$('procText').textContent=done+'/'+n+' done...';
    if(done===n){proc.classList.remove('show');if(n>1)fab.classList.add('show')}
  }));
}
function processImage(file,idx,cb){
  const r=new FileReader();
  r.onload=e=>{
    const img=new Image();
    img.onload=()=>{
      const maxDim=parseInt($('maxDim').value)||600;
      const maxBytes=(parseInt($('maxKB').value)||80)*1024;
      const fmt=$('fmt').value;
      const ext=fmt==='image/webp'?'.webp':fmt==='image/png'?'.png':'.jpg';
      let w=img.width,h=img.height;const ow=w,oh=h;
      if(w>maxDim||h>maxDim){if(w>=h){h=Math.round(h*maxDim/w);w=maxDim}else{w=Math.round(w*maxDim/h);h=maxDim}}
      const c=document.createElement('canvas');c.width=w;c.height=h;
      c.getContext('2d').drawImage(img,0,0,w,h);
      if(fmt==='image/png'){c.toBlob(blob=>{showResult(blob,w,h,ow,oh,file.name,ext,maxBytes);cb()},fmt);return}
      let lo=.05,hi=.92,best=null;
      function bs(){let mid=(lo+hi)/2;
        c.toBlob(blob=>{if(!blob){cb();return}
          if(blob.size<=maxBytes){best=blob;lo=mid+.01}else{hi=mid-.01}
          if(hi-lo>.02&&hi>.05)bs();
          else if(!best)c.toBlob(b=>{showResult(b,w,h,ow,oh,file.name,ext,maxBytes);cb()},fmt,.05);
          else{showResult(best,w,h,ow,oh,file.name,ext,maxBytes);cb()}
        },fmt,mid);
      }bs();
    };img.src=e.target.result;
  };r.readAsDataURL(file);
}
function showResult(blob,w,h,ow,oh,name,ext,maxBytes){
  const url=URL.createObjectURL(blob);const sKB=(blob.size/1024).toFixed(1);
  const ok=blob.size<=maxBytes;const fname=name.replace(/\.[^.]+$/,'')+ext;
  blobs.push({url,fname,blob});
  const card=document.createElement('div');card.className='card';
  const shareBtn=navigator.share?'<button onclick="shareFile('+(blobs.length-1)+')">\u2197 Share</button>':'';
  card.innerHTML='<img class="preview" src="'+url+'" alt="'+fname+'"><div class="body"><div class="meta"><span class="fname">'+fname+'</span><span class="size '+(ok?'ok':'over')+'">'+sKB+' KB</span></div><div class="dims">'+ow+'\u00D7'+oh+' \u2192 '+w+'\u00D7'+h+'px</div><div class="actions"><a href="'+url+'" download="'+fname+'">\u2B07 Save</a>'+shareBtn+'</div></div>';
  res.appendChild(card);
}
function shareFile(i){const b=blobs[i];navigator.share({files:[new File([b.blob],b.fname,{type:b.blob.type})],title:'Neo.jpg'}).catch(()=>{});}
function downloadAll(){blobs.forEach(b=>{const a=document.createElement('a');a.href=b.url;a.download=b.fname;a.click()})}
function clearAll(){blobs.forEach(b=>URL.revokeObjectURL(b.url));blobs=[];res.innerHTML='';fab.classList.remove('show');hint.style.display='block'}
if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js').catch(()=>{})}
</script>
</body>
</html>